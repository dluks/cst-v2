schema: '2.0'
stages:
  standardize_other_products:
    cmd: python src/data/standardize_other_products.py
    deps:
    - path: data/raw/other-trait-maps
      hash: md5
      md5: 4e2634f828ab66f4fe29d28e5e9db7cf.dir
      size: 32055984651
      nfiles: 1509
    - path: src/data/standardize_other_products.py
      hash: md5
      md5: 392228f98044cd552c75c66d2c8c2e73
      size: 4659
    outs:
    - path: data/interim/other_trait_maps
      hash: md5
      md5: 4ce80d8ff95ecdcbad3f7738ed93d461.dir
      size: 1183362520
      nfiles: 63
  build_container:
    cmd: stages/build_container.sh singularity cit-sci-traits latest cit-sci-traits.def
      cit-sci-traits.sif
    deps:
    - path: README.md
      hash: md5
      md5: c255f86c149ea407ee916b3eb75be456
      size: 9726
    - path: cit-sci-traits.def
      hash: md5
      md5: a9ece716692785bb77a429cccfd774d0
      size: 1465
    - path: poetry.lock
      hash: md5
      md5: 8f7cfac13e06acaf604d74b7951ca402
      size: 667727
    - path: pyproject.toml
      hash: md5
      md5: abb62da99ab8238dbfd94f6814da0866
      size: 1732
    - path: stages/build_container.sh
      hash: md5
      md5: 52742d9dcb076bd83a511a755757a5f3
      size: 917
      isexec: true
    params:
      params.yaml:
        container:
          type: singularity
          name: cit-sci-traits
          docker_tag: latest
          def: cit-sci-traits.def
          image: cit-sci-traits.sif
    outs:
    - path: cit-sci-traits.sif
      hash: md5
      md5: 2168f356be5b96afb1549bb3bec41a15
      size: 20662411264
      isexec: true
  get_TRY_mean_traits:
    cmd: stages/get_TRY_mean_traits.sh singularity cit-sci-traits latest cit-sci-traits.sif
      poetry run python src/data/build_try_traits.py
    deps:
    - path: data/raw/TRY_6_gapfilled_for_distribution/TRY6_gapfilled_for_distribution.zip
      hash: md5
      md5: f2cc4a7dd419bed117f42e62780b16e8
      size: 307941318
    - path: src/data/build_try_traits.py
      hash: md5
      md5: 67de4c1da7c8459a46379ec9ef05c691
      size: 6309
    params:
      params.yaml:
        PFT: Grass
        trydb:
          raw:
            dir: TRY_6_gapfilled_for_distribution
            zip: TRY6_gapfilled_for_distribution.zip
            zipfile_csv: TRY6_gapfilled_for_distribution/TRY6_gapfilled_filtered_2.csv.zip
            pfts: try_pft_v2.parquet
          interim:
            dir: try
            quantile_range:
            transform: power
            already_norm:
            filtered: traits.parquet
            transformer_fn: power_transformer.pkl
    outs:
    - path: data/interim/try/power_transformer.pkl
      hash: md5
      md5: 3af58b921bc9e9fe73758f2337be08b1
      size: 2163
    - path: data/interim/try/traits.parquet
      hash: md5
      md5: 104c0200f41f91ca4be7973dccdc234f
      size: 4473730
  match_gbif_pfts:
    cmd: stages/match_gbif_pfts.sh singularity cit-sci-traits latest cit-sci-traits.sif
      poetry run python src/data/match_gbif_pfts.py
    deps:
    - path: data/raw/all_tracheophyta_non-cult_2024-04-10
      hash: md5
      md5: ada860692d425bd047bd09fd4531fdbf.dir
      size: 30005038638
      nfiles: 1584
    - path: data/raw/try_pft_v2.parquet
      hash: md5
      md5: d49a4b1611eebbd529c9e9aba6aa5f69
      size: 2232209
    - path: src/data/match_gbif_pfts.py
      hash: md5
      md5: 957225b51ba6d03bb35139a7fabc6059
      size: 3375
    params:
      params.yaml:
        datasets.Y.gbif: all_tracheophyta_non-cult_2024-04-10
        gbif.interim.dir: gbif
        gbif.interim.matched: gbif_pfts.parquet
        gbif.raw.dir: all_tracheophyta_non-cult_2024-04-10
    outs:
    - path: data/interim/gbif/gbif_pfts.parquet
      hash: md5
      md5: c7504b332aaf296efab1598be6bfbf61.dir
      size: 2938908051
      nfiles: 159
  extract_splot:
    cmd: stages/extract_splot.sh singularity cit-sci-traits latest cit-sci-traits.sif
      poetry run python src/data/extract_splot.py
    deps:
    - path: data/raw/splot4-0
      hash: md5
      md5: 99990a51d13fe4485f72dd03590d44a6.dir
      size: 521575464
      nfiles: 3
    - path: src/data/extract_splot.py
      hash: md5
      md5: 2a89310e584294f1661965d542a50d18
      size: 3108
    params:
      params.yaml:
        datasets.Y.splot: splot4-0
        splot.interim.dir: splot
    outs:
    - path: data/interim/splot/extracted
      hash: md5
      md5: 79e5388fb25a0c2fa5af8eb08c26498e.dir
      size: 508142149
      nfiles: 3
