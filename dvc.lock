schema: '2.0'
stages:
  standardize_other_products:
    cmd: python src/data/standardize_other_products.py
    deps:
    - path: data/raw/other-trait-maps
      hash: md5
      md5: 848dac77f0897cf7e58f41a196fe1d68.dir
      size: 32055985074
      nfiles: 1510
    - path: src/data/standardize_other_products.py
      hash: md5
      md5: 2e4c967cc9dda5883850576253521e00
      size: 4665
    outs:
    - path: data/interim/other_trait_maps
      hash: md5
      md5: 4ce80d8ff95ecdcbad3f7738ed93d461.dir
      size: 1183362520
      nfiles: 63
  build_container:
    cmd: stages/build_container.sh singularity cit-sci-traits latest cit-sci-traits.def
      cit-sci-traits.sif
    deps:
    - path: README.md
      hash: md5
      md5: c255f86c149ea407ee916b3eb75be456
      size: 9726
    - path: cit-sci-traits.def
      hash: md5
      md5: a9ece716692785bb77a429cccfd774d0
      size: 1465
    - path: poetry.lock
      hash: md5
      md5: 8f7cfac13e06acaf604d74b7951ca402
      size: 667727
    - path: pyproject.toml
      hash: md5
      md5: abb62da99ab8238dbfd94f6814da0866
      size: 1732
    - path: stages/build_container.sh
      hash: md5
      md5: 52742d9dcb076bd83a511a755757a5f3
      size: 917
      isexec: true
    params:
      params.yaml:
        container:
          type: singularity
          name: cit-sci-traits
          docker_tag: latest
          def: cit-sci-traits.def
          image: cit-sci-traits.sif
    outs:
    - path: cit-sci-traits.sif
      hash: md5
      md5: 2168f356be5b96afb1549bb3bec41a15
      size: 20662411264
      isexec: true
  get_TRY_mean_traits:
    cmd: stages/get_TRY_mean_traits.sh singularity cit-sci-traits latest cit-sci-traits.sif
      "poetry run python src/data/build_try_traits.py"
    deps:
    - path: src/data/build_try_traits.py
      hash: md5
      md5: e3ef256b57cc86f8d3a34fa24c9d33ac
      size: 15201
    params:
      params.yaml:
        PFT: Shrub_Tree_Grass
        try_version: 6
        trydb:
          raw:
            try6:
              dir: TRY_6_gapfilled_for_distribution
              zip: TRY6_gapfilled_for_distribution.zip
              zipfile_csv: TRY6_gapfilled_for_distribution/TRY6_gapfilled_filtered_2.csv.zip
            try5:
              dir: TRY_5_GapFilledData_2020
              zip: TRY_5_GapFilledData_2020.zip
              zipfile_csv: 
                TRY_50_2020_01/gapfilled_data/mean_gap_filled_back_transformed_incl_species_names.csv
            pfts: try_pft_v2.parquet
          interim:
            dir: try
            quantile_range:
            transform:
            already_norm:
            filtered: traits.parquet
            transformer_fn: no_transform.pkl
            perform_pca: false
            pca_n_components: 4
            pca_fn: no_pca.pkl
    outs:
    - path: data/interim/try/no_pca.pkl
      hash: md5
      md5: d41d8cd98f00b204e9800998ecf8427e
      size: 0
    - path: data/interim/try/no_transform.pkl
      hash: md5
      md5: 7d1e55650014e21b4568ed3e3d1fc531
      size: 4
    - path: data/interim/try/traits.parquet
      hash: md5
      md5: c1e2d9ece0b657ebf33b0886786764e7
      size: 1658143
  extract_splot:
    cmd: stages/extract_splot.sh singularity cit-sci-traits latest cit-sci-traits.sif
      "poetry run python src/data/extract_splot.py"
    deps:
    - path: data/raw/sPlotOpen_v76
      hash: md5
      md5: c06b62279da8afd1048f42572852ecc6.dir
      size: 526410695
      nfiles: 12
    - path: src/data/extract_splot.py
      hash: md5
      md5: 81870e467b6fabf2fab2c844f0cc87bb
      size: 4939
    params:
      params.yaml:
        datasets.Y.splot: sPlotOpen_v76
        splot.interim.dir: splot
    outs:
    - path: data/interim/splot/extracted
      hash: md5
      md5: a72673c4a61c5107c5af271a945ecfc1.dir
      size: 47948903
      nfiles: 3
